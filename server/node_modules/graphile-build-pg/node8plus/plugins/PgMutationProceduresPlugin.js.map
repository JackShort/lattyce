{"version":3,"sources":["../../src/plugins/PgMutationProceduresPlugin.js"],"names":["PgMutationProceduresPlugin","builder","hook","fields","build","context","extend","pgIntrospectionResultsByKind","introspectionResultsByKind","inflection","pgMakeProcField","makeProcField","pgOmit","omit","swallowError","scope","isRootMutation","fieldWithHooks","procedure","filter","proc","isStable","namespace","reduce","memo","fieldName","functionMutationName","isMutation","e"],"mappings":";;;;;;kBAGgB,SAASA,0BAAT,CAAoCC,OAApC,EAA6C;AAC3DA,UAAQC,IAAR,CAAa,0BAAb,EAAyC,CAACC,MAAD,EAASC,KAAT,EAAgBC,OAAhB,KAA4B;AACnE,UAAM;AACJC,YADI;AAEJC,oCAA8BC,0BAF1B;AAGJC,gBAHI;AAIJC,uBAAiBC,aAJb;AAKJC,cAAQC,IALJ;AAMJC;AANI,QAOFV,KAPJ;AAQA,UAAM;AACJW,aAAO,EAAEC,cAAF,EADH;AAEJC;AAFI,QAGFZ,OAHJ;AAIA,QAAI,CAACW,cAAL,EAAqB;AACnB,aAAOb,MAAP;AACD;AACD,WAAOG,OACLH,MADK,EAELK,2BAA2BU,SAA3B,CACGC,MADH,CACUC,QAAQ,CAACA,KAAKC,QADxB,EAEGF,MAFH,CAEUC,QAAQ,CAAC,CAACA,KAAKE,SAFzB,EAGGH,MAHH,CAGUC,QAAQ,CAACP,KAAKO,IAAL,EAAW,SAAX,CAHnB,EAIGG,MAJH,CAIU,CAACC,IAAD,EAAOJ,IAAP,KAAgB;AACtB;;;;;;;;;;;;;;;AAeA,YAAMK,YAAYhB,WAAWiB,oBAAX,CAAgCN,IAAhC,CAAlB;AACA,UAAI;AACFI,aAAKC,SAAL,IAAkBd,cAAcc,SAAd,EAAyBL,IAAzB,EAA+BhB,KAA/B,EAAsC;AACtDa,wBADsD;AAEtDU,sBAAY;AAF0C,SAAtC,CAAlB;AAID,OALD,CAKE,OAAOC,CAAP,EAAU;AACVd,qBAAac,CAAb;AACD;AACD,aAAOJ,IAAP;AACD,KA9BH,EA8BK,EA9BL,CAFK,EAiCJ,kDAjCI,CAAP;AAmCD,GAnDD;AAoDD,C","file":"PgMutationProceduresPlugin.js","sourcesContent":["// @flow\nimport type { Plugin } from \"graphile-build\";\n\nexport default (function PgMutationProceduresPlugin(builder) {\n  builder.hook(\"GraphQLObjectType:fields\", (fields, build, context) => {\n    const {\n      extend,\n      pgIntrospectionResultsByKind: introspectionResultsByKind,\n      inflection,\n      pgMakeProcField: makeProcField,\n      pgOmit: omit,\n      swallowError,\n    } = build;\n    const {\n      scope: { isRootMutation },\n      fieldWithHooks,\n    } = context;\n    if (!isRootMutation) {\n      return fields;\n    }\n    return extend(\n      fields,\n      introspectionResultsByKind.procedure\n        .filter(proc => !proc.isStable)\n        .filter(proc => !!proc.namespace)\n        .filter(proc => !omit(proc, \"execute\"))\n        .reduce((memo, proc) => {\n          /*\n            proc =\n              { kind: 'procedure',\n                name: 'integration_webhook_secret',\n                description: null,\n                namespaceId: '6484381',\n                isStrict: false,\n                returnsSet: false,\n                isStable: true,\n                returnTypeId: '2950',\n                argTypeIds: [ '6484569' ],\n                argNames: [ 'integration' ],\n                argDefaultsNum: 0 }\n            */\n\n          const fieldName = inflection.functionMutationName(proc);\n          try {\n            memo[fieldName] = makeProcField(fieldName, proc, build, {\n              fieldWithHooks,\n              isMutation: true,\n            });\n          } catch (e) {\n            swallowError(e);\n          }\n          return memo;\n        }, {}),\n      `Adding mutation procedure to root Mutation field`\n    );\n  });\n}: Plugin);\n"]}